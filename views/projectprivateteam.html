{% extends "secure.html" %}

{% block title %}{{ project.project_name }}{% endblock title %}

{% block description %}{{ project.project_description }}{% endblock description %}

{% block custom_script %}

$(document).ready(function() {

    // Click Event for Existing Opening
    $('.opening_row').on('click', function(e) {

        var project = $('#project-name').html();
        var created = $(this).data('id');

        get_opening_details(project, created);

    });

    $('#opening').modal({
        show: false
    });

    var get_opening_details = function(project_id, opening_created){
        var opening_details = {};
        $.ajax({
            data:{'project_id':project_id, 'opening_created': opening_created},
            url: "/opening/new",
            async: true,
            type: "GET",
            success: function(response) {
                opening_details = jQuery.parseJSON( response );
                /*
                {"role": "role2",
                "skills": ["skill1", " skill2"],
                "created": "datetime",
                "description": "descr2"
                "commitment" : "0-5 hours/week"}
                */
                $('#opening_role').val(opening_details.role);
                $('#opening_description').val(opening_details.description);
                $('#opening_skills').val(opening_details.skills);
                $('#opening_created').val(opening_created);
                $('#opening_commitment> option[value="+opening_details.commitment+"]').attr("selected", "selected");

            },
            error: function(response) {
                $("#save_opening").addClass('disabled');
                $('#save_opening').html('Something went wrong.');
            }
        });
    };

    $('body').on('hidden', '.modal', function () {
        $(this).data('modal', null);

    });

  $('#opening_body').validate();

  $('#save_opening').on('click', function(e) {

        var valid = $('#opening_body').valid();

        if(valid) {
        // save a goal
            var project = $('#project-name').html();
            var opening_role = $('#opening_role').val();
            var opening_description = $('#opening_description').val();
            var opening_skills = $('#opening_skills').val();
            var opening_commitment = $('#opening_commitment').val();
            var opening_created = $(this).data('id');

            $.ajax({
                data:{'project_id' : project, 'opening_role' : opening_role, 'opening_description' : opening_description, 'opening_skills' : opening_skills, 'opening_commitment' : opening_commitment},
                url: "/opening/new",
                async: true,
                type: "POST",
                success: function(response) {

                    if (response=='ok'){
                        $("#modal-close").click();
                        $(window.location.replace('/build/project/{{ project.key.id() }}/team'));
                    }
                    if (response=='bad project'){
                        $("#save_opening").addClass('disabled');
                        $('#save_opening').html('Project Error');
                    }
                },
                error: function(response) {
                $("#save_opening").addClass('disabled');
                $('#save_opening').html('Something went wrong.');
                }
            });
        }
    });
});


{% endblock custom_script %}

{% block page %}

<div class="main">
    <div class="container">
        <div class="wrapper">
            <div class="row-fluid topic-main">
                <div class="span2">
                    <!-- INSERT PICTURE FROM PROFILE -->
                    <img alt="{{ project.key.id() }}" class="thumbnail img-polaroid member-pic" />
                </div>
                <div class="span5">
                    <span class="pull-right"><strong>Followers: </strong>?</span>
                    <div class="pull-right">
                        <a class="btn" href="#">
                            <img alt="Share" src=""/>
                        </a>
                        <a class="btn" href="#">
                            <img alt="Invite" src=""/>
                        </a>
                    </div>
                    <h2 id="project-name">{{ project.key.id() }}</h2>
                    <p>{{ project.description }}</p>
                    <p>List Tags</p>
                </div>
                <div class="span5">
                    <div class="row-fluid">
                        <a class="quick-button-small span2">
                            <img alt="Discussions" src="/static/img/conversation.png" />
                            <span class="notification discussions">7</span>
                            <p>Discussions</p>
                        </a>
                        <a class="quick-button-small span2">
                            <img alt="Ideas" class="ideas" src="/static/img/lightbulb.png" />
                            <span class="notification ideas">7</span>
                            <p>Ideas</p>
                        </a>
                        <a class="quick-button-small span2">
                            <img alt="Questions" class="questions" src="/static/img/question.png" />
                            <span class="notification ideas">7</span>
                            <p>Questions</p>
                        </a>
                        <a class="quick-button-small span2">
                            <img alt="Articles" class="articles" src="/static/img/warning_sign.png" />
                            <p>Issues</p>
                            <span class="notification ideas">7</span>
                        </a>
                        <a class="quick-button-small span2">
                            <img alt="Articles" class="articles" src="/static/img/newspaper.png" />
                            <span class="notification ideas">?</span>
                            <p class="quick-button-small-article">Articles</p>
                        </a>
                        <a class="quick-button-small span2">
                            <img alt="Followers" src="/static/img/group.png" />
                            <span class="notification followers">?</span>
                            <p>Something</p>
                        </a>
                    </div>
                </div>
            </div>

            <hr class="heavy">

            <div class="row-fluid topic-body">
                <div class="span12">
                    <ul class="nav nav-pills btn-topic pull-right">
                        <li><a href="/build/project/{{ project.key.id() }}/hub">News</a></li>
                        <li><a href="#">Backlog</a></li>
                        <li><a href="#">Tasks</a></li>
                        <li class="active"><a href="#">Team</a></li>
                        <li><a href="#">Experiments</a></li>
                        <li><a href="#">Metrics</a></li>
                    </ul>
                </div>
            </div>
            <div class="row-fluid">
                <div class="box span12">
                    <div class="box-header">
                        <h2><img src="/static/img/certificate.png" class="certificate"/>
                            <span class="break"></span>Project Team Openings
                        </h2>
                        <div class="box-icon">
                            <a href="#opening" role="button" class="btn-setting" data-toggle="modal"><img src="/static/img/halflings_plus.png"/></a>
                        </div>
                    </div>
                    <div class="table-box-content">
                        <table class="table table-hover table-bordered" id="team_opening">
                            <thead class="table_head">
                            <tr>
                                <th class="goal-header">Role</th>
                                <th>Created</th>
                                <th>Views</th>
                                <th>Applications</th>
                            </tr>
                            </thead>
                            <tbody id="sortable_opening">
                            {% for opening in project.team_openings %}
                                <tr>
                                    <td><img src="/static/img/halflings_justify.png"/><span class="row-break"></span><a href="#opening" role="button" class="opening_row" data-toggle="modal" data-id="{{ opening.created }}">{{ opening.role }}</a></td>
                                    <td class="text-center">{{ opening.created }}</td>
                                    <td class="text-center">NEED</td>
                                    <td class="text-center">NEED</td>
                                </tr>
                            {% else %}
                                <tr class="info">
                                    <td colspan="3" class="table-row"><strong>No current openings for project found.</strong></td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="row-fluid">
                    <div class="box span6">
                        <div class="box-header">
                            <h2><img src="/static/img/certificate.png" class="certificate"/>
                                <span class="break"></span>Team
                            </h2>
                            <div class="box-icon">
                                <a href="#" class="btn-setting" data-toggle="modal" data-target="#add_goal"><img src="/static/img/halflings_plus.png"/></a>
                            </div>
                        </div>

                        <div class="table-box-content">
                            <table class="table table-hover table-bordered" id="team_members">
                                <thead class="table_head">
                                <tr>
                                    <th class="goal-header">Team Member</th>
                                    <th>Project Role</th>
                                    <th>Status</th>
                                </tr>
                                </thead>
                                <tbody id="sortable">
                                {% for member in project.team_members %}
                                    <tr>
                                        <td><img src="/static/img/halflings_justify.png"/><span class="row-break"></span><a href="/community/profile/{{ member.member.id() }}">{{ member.member.id() }}</a></td>
                                        <td class="hidden-column">{{ member.member }}</td>
                                        <td class="text-center">{{ member.role }}</td>
                                        <td>
                                            <span class="label label-success">{{ member.active }}</span>
                                        </td>
                                    </tr>
                                {% else %}
                                    <tr class="info">
                                        <td colspan="3" class="table-row"><strong>No team members found. Please add some.</strong></td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODAL TO EDIT AN OPENING -->
<div id="opening" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="opening_label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" id="opening-close" class="close" data-dismiss="modal" aria-hidden="true"><img src="/static/img/halflings_circle_remove.png"/></button>
        <h3 id="opening_label">Edit Project Team Opening</h3>
    </div>

    <div class="modal-body">
        <form class="form-horizontal" id="opening_body">
            <div class="control-group">
                <label class="control-label" for="opening_role">Role</label>
                <div class="controls">
                    <input class="span3" id="opening_role" required name="opening_role"
                           size="50" type="text" maxlength="50" placeholder="Enter a short name for your goal."/>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="opening_description">Description</label>
                <div class="controls">
                    <textarea rows="3" class="required span3" id="opening_description" name="opening_description"
                              required maxlength="500" placeholder="Enter a brief but specific description for the role. (500 max)"> </textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="opening_skills">Skills</label>
                <div class="controls">
                    <textarea rows="3" class="span3" id="opening_skills" required name="opening_skills"
                              placeholder="Provide keywords (separated by a comma) that help describe the skills for the role."> </textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="opening_commitment">Commitment Sought<br/><small>(in hours per week)</small></label>
                <div class="controls">
                    <select id="opening_commitment">
                        <option>0-5 hours/week</option>
                        <option>6-10 hours/week</option>
                        <option>10+ hours/week</option>
                    </select>
                </div>
            </div>
            <div>
                <input class="span3" type="hidden" id="opening_created" />
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" id="save_opening">Update</button>
    </div>
</div>
<!-- END MODAL EDIT AN OPENING -->

<!-- MODAL TO ADD AN OPENING
<div id="add_opening" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="add_opening_label" aria-hidden="true">
    <div class="modal-header">
        <button type="button" id="add-opening-close" class="close" data-dismiss="modal" aria-hidden="true"><img src="/static/img/halflings_circle_remove.png"/></button>
        <h3 id="add_opening_label">Create Project Team Opening</h3>
    </div>

    <div class="modal-body">
        <form class="form-horizontal" id="add_opening_body">
            <div class="control-group">
                <label class="control-label" for="add_opening_role">Role</label>
                <div class="controls">
                    <input class="span3" id="add_opening_role" required name="add_opening_role"
                           size="50" type="text" maxlength="50" placeholder="Enter a short name for your goal."/>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="add_opening_description">Description</label>
                <div class="controls">
                    <textarea rows="3" class="required span3" id="add_opening_description" name="add_opening_description"
                              required maxlength="500" placeholder="Enter a brief but specific description for this goal. (500 max)"> </textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="add_opening_skills">Skills</label>
                <div class="controls">
                    <textarea rows="3" class="span3" id="add_opening_skills" name="add_opening_skills"
                              placeholder="Provide keywords (separated by a comma) that help describe the skills  - supports search."> </textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="add_opening_commitment">Commitment Sought<br/><small>(in hours per week)</small></label>
                <div class="controls">
                    <select id="add_opening_commitment">
                        <option>0-5 hours/week</option>
                        <option>6-10 hours/week</option>
                        <option>10+ hours/week</option>
                    </select>
                </div>
            </div>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" id="create_opening">Create</button>
    </div>
</div>
END MODAL EDIT AN OPENING -->

{% endblock page %}